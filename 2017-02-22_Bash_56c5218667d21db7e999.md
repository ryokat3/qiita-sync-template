<!--
title:   Bourne Shell から Bash への移行ガイド
tags:    Bash
id:      56c5218667d21db7e999
private: false
-->
Bash (/bin/bash) にはあるけど、Bourne Shell (/bin/sh) にない便利な機能。

## \[\[ \]\]  

\[ \] をより使いやすくする


- **エラーフリー** :  `[[ "" == "abc" ]]` _/ * 空白文字を比較してもエラーにならない */_
- **AND, OR** :  `&&` `||` _/* `-a` `-o` の置き換え */_
- **正規表現** : `[[ <文字列> =~ <正規表現> ]]`
  - <正規表現> を `'` や `"` で囲む必要はない
  - `BASH_REMATCH[1]` などで後方参照が可能


## (( ))

if文の数値比較条件式

- **変数** : `if (( x ))` _/* 0: False, default: True */_
- **同値比較** : `if (( x == x ))`  `if (( x != y ))`
- **大小比較** : `if (( XXX > x ))` `if (( x < XXX ))` `if (( X >= x ))` `if (( x <= X ))`
- **AND,OR,NOT** : `if (( x && y ))`, `if (( x || y ))`, `if (( ! x ))`

for文の条件式

- **繰り返し** : `for (( x=0 ; x<10 ; x++ ))`


## 変数宣言

- **数値** : `declare -i num=1+2`
- **配列** : `declare -a array=(Zero One Two)`
- **連想配列** : `declare -A assoc=([Jan]=1 [Feb]=2 [Mar]=3)`
- **定数** : `declare -r RO="Read-Only"`
- **環境変数** : `declare -x JAVA_HOME="/usr/local/java"`


## 配列

- **宣言** : `declare -a array=(Zero One Two)`
- **リスト** : `${array[@]}` _/* Zero One Two */_
- **リスト（逆順）** : `${!array[@]}` _/* Two One Zero */_
- **要素数** : `${#array[@]}` _/* 3 */_
- **先頭要素** : `${array[0]}` _/* Zero */_
- **追加（先頭）** : `array=(elem "${array[@]}")`
- **追加（最後）** : `array=("${array[@]}" elem)`
- **削除** : `unset array[1]` _/* Zero "" Two */_


## 連想配列

- **宣言** : `declare -A assoc=([Jan]=1 [Feb]=2 [Mar]=3)`
- **キーリスト** : `${assoc[*]}` _/* Jan Feb Mar (順序未定) */_


## () : サブシェル

サブシェルによるコマンド呼出し。`;`で区切って複数のコマンドを呼び出すことが可能。
サブシェルなので環境変数を設定しても、もとのシェルの環境変数は汚さない。

```bash
$ (export HEHE="hello, world"; echo $HEHE)
hello, world
$ echo $HEHE

$
```


## $( )

\` \`によるコマンド呼出しをより使い易くする

- **入れ子** : `$(echo $(ls))`

## <( ), >( ) : プロセス置換

プロセス置換。引数で、標準出力とか標準入力を指定できないコマンドを無理やりパイプみたいに繋げたい、という時。( )内は非同期実行のコマンドで置き換えられる。

- **<( ) : (標準出力) ⇒ 入力ファイル** : `cp <(ls) ls.txt`
- **>( ) : 出力ファイル ⇒ (標準入力)** : `cp ls.txt >(wc -l)`


## 参照渡し

`${!var-name}`とすれば、`${var-name}`に（値じゃなく）変数が
入っている場合に、その参照している値を取り出す。
配列を関数の引数にしたりできる。

```bash
function echo_array() {
   local array=(${!1})    # 配列を引数として受け取る
   echo ${array[@]}
}

declare -a var=("Zero" "One" "Two")
echo_array var[@]         # 配列を引数として関数を呼び出す
```


## trap

シグナルを受けた時の動作に加え、こんな時にもコマンドを起動できる。

- **EXIT** : シェルが終った時に起動する。
- **DEBUG** : 全てのコマンドの前に起動する。
- **ERR** : コマンドがエラーを返したら起動する。


## 整数リスト {1..10}

整数値のリストを簡単に作成できる。

- **{1..10}** : 1 2 3 4 5 6 7 8 9 10
- **{-2..2}** : -2 -1 0 1 2
- **{0..5} {10..15}** : 0 1 2 3 4 5 10 11 12 13 14 15


## プロンプト PS1

環境変数 `PS1` の文字列を評価してくれる。`$( )`によるコマンド呼出しも受け付けてくれる。
`$` の前に `\` でエスケープしておかないと最初の一回しか評価してくれないので注意。

- **現在時刻の表示** : `PS1="\[\e[30m\e[47m\]\W(\$(date +%H:%M))\$\[\e[0m\] "`
- **GIT ブランチの表示** : `PS1="\[\e[30m\e[47m\]\W[\$(git rev-parse --abbrev-ref HEAD 2> /dev/null || echo -)]$\[\e[0m\] "`